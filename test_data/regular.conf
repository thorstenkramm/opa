#
# Get more information on https://github.com/thorstenkramm/opa
#

[main]
# Base directory to store backups, logs and meta data. Mandatory.
# Directory must exist.
backup_dir = "/tmp/opa"

# How many versions to keep. Optional.
# Older version will be removed.
# Default: 1
versions = 4

# Whether to delete old version before or after the current backup
# Default: false (delete old backups after the current backup)
# Requires: skip_unchanged_dbs = false
#delete_before = true

# Perform backup using streamcompress. This creates a single archive with all file individually compressed by qpress.
# Fastest backup with lowest disk space consumption.
# Requires additional steps to restore. Mutual exclusive with perpare and tgz.
# Default: false
streamcompress = false

# Run the prepare step after the backup.
# Mutual exclusive with streamcompress.
# Default: false
prepare = false

# Compress the backup into a single tar.gz file
# Mutual exclusive with streamcompress.
# Default: false
tgz = false

# How many subroutines to run in parallel. Optional.
# Negative values are subtracted from total CPUs.
# -2 on 10 CPUs means a  parallelism of 8.
# If a negative value would lead to parallelism of 0 or less, 1 is used.
# Setting also applies to the tar.gz compression, when pigz utility is found.
# Default: number of CPUs
parallelism = -2

# Path to xtrabackup executable. Optional.
# Optional. If not given, it's expected in the default path.
#xtrabackup_bin = "/usr/local/bin/xtrabackup"

# Path to mysql executable. Optional.
# Optional. If not given, it's expected in the default path.
#mysql_bin = "/usr/local/bin/mysql"

# List of command line arguments appended to xtrabackup processes. Optional.
# Default: [] (No extra arguments)
#xtrabackup_options = ['--no-lock','--rsync']

# Log level, one of debug,info,warning,error. Optional.
# Default: info
log_level = "debug"

[conditions]
# List of commands executed with /bin/sh before the backup starts.
# If any of the commands defined in the skip_conditions list exits with exit code  0,
# the backup is skipped but considered successful. On first exit code 0, the rest of the commands are skipped.
# This is useful for intentionally skipping backups without logging an error.
#skip_conditions = ['ifconfig|grep -q 192.168.178.1']

# Timeout (seconds) after which skip_conditions are aborted.
# If timeout is reached, the test is considered failed and the backup is run.
# The timeout applies to each command individually.
# Default: 0 (no limits)
#skip_conditions_timeout = 240

# List of commands executed with /bin/sh before the backup starts.
# Only if all commands defined in the run_conditions list exit with exit code  0,
# the backup will be run. If one of the command fails, backup is skipped and considered
# faulty. On first exit code > 0, the rest of the commands are skipped.
# This is useful to abort backups if crucial conditions are not met.
#run_conditions ['mount|grep -q /var/backups']

# Timeout (seconds) after which run_conditions are aborted.
# If timeout is reached, the test is considered failed and the backup is aborted with an error.
# The timeout applies to each command individually.
# Default: 0 (no limits)
#run_conditions_timeout = 240

# List of commands executed with /bin/sh after the backup has ended.
# If any of the commands defined in the terminate_conditions list exits with exit code > 0,
# an error is logged and the backup is considered faulty.
# This is useful for e.g. for copying backups to a remote storage.
# On first exit code > 0, the rest of the commands are skipped.
# The environment variable $OMA_CURRENT_DIR is filled with the full path to the current backup directory
# without a trailing slash.
#terminate_conditions = ['rsync -a $OMA_CURRENT_DIR user@host:/var/backups/']

# Timeout (seconds) after which terminate_conditions are aborted.
# If timeout is reached, the command is considered failed and an error is logged.
# The timeout applies to each command individually.
# Default: 0 (no limits)
#terminate_conditions_timeout = 240

[zabbix]
# Zabbix Sender Item Key. Optional.
# Send current log file after the backup to zabbix using the given item key
# Default: "" (not set, Log is not sent to Zabbix)
item_key = "opa.log"

# Path to zabbix_sender executable. Optional.
# Optional. If not given, it's expected in the default path.
sender_bin = "./test_data/zabbix_sender"

# Path to zabbix_agentd.conf used for zabbix_sender. Optional
# Default: /etc/zabbix/zabbix_agentd.conf
#agent_conf = ""